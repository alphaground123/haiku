<!DOCTYPE html>  <html> <head>   <title>page.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="haiku.html">                 haiku.js               </a>                                           <a class="source" href="cli.html">                 cli.js               </a>                                           <a class="source" href="collection.html">                 collection.js               </a>                                           <a class="source" href="logger.html">                 logger.js               </a>                                           <a class="source" href="page.html">                 page.js               </a>                                           <a class="source" href="server.html">                 server.js               </a>                                           <a class="source" href="site.html">                 site.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               page.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;underscore&quot;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">yaml</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;yamlparser&quot;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">mustache</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mustache&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">markdown</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;marked&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">textile</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;stextile&#39;</span><span class="p">)</span>
<span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>a page object basically encapsulates a file. the tricky part here is
that it has to know how to render itself and may have an arbitrary number
of content processors associated with it. we determine the processors to
apply using the extensions. so "foo.textile.mustache" is first run through
mustache and then textile.</p>

<p>this doesn't work right now with partials, which are assumed to be rendered
using whatever template processor the content that includes is using</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Page</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">site</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">site</span><span class="p">;</span> <span class="c1">// parent site</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span> <span class="c1">// parent collection</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">path</span><span class="p">;</span> <span class="c1">// path of the file we&#39;re encapsulating</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="c1">// the raw file content</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">site</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;creating a new page object for [&quot;</span> <span class="o">+</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>we can add processors here -- a processor is just a function that takes the
page data (not the object), any attributes to use in the processor, and
the site itself. a processor is free to ignore whichever of these it wants.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Page</span><span class="p">.</span><span class="nx">processors</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">textile</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span><span class="nx">attributes</span><span class="p">,</span><span class="nx">site</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">textile</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">mustache</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span><span class="nx">attributes</span><span class="p">,</span><span class="nx">site</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span><span class="nx">attributes</span><span class="p">,</span><span class="nx">site</span><span class="p">.</span><span class="nx">partials</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>dust: function(content,attributes,site) {
   return dust.renderSource(content, attributes,function(err,output) {</p>

<p>});
 },</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">markdown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span><span class="nx">attributes</span><span class="p">,</span><span class="nx">site</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">markdown</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>a utility function that extracts any "front-matter" from the data
and parses it as YAML; we return an object with a data property
and an attributes property</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Page</span><span class="p">.</span><span class="nx">_createResource</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>http://stackoverflow.com/q/1068308</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/^(\s*---([\s\S]+)---\s*)/gi</span>
      <span class="p">,</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">regex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>if we have a match ...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>extract the YAML (get rid of leading and trailing whitespace)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">yamlString</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>extract the template, sans the YAML</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">,</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>return the resource object, with attributes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="p">{</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="nx">template</span><span class="p">,</span>
      <span class="nx">attributes</span><span class="o">:</span> <span class="nx">yaml</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="nx">yamlString</span><span class="p">)</span>
    <span class="p">};</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// we didn&#39;t have a match ...</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span> <span class="c1">// return the data we got</span>
      <span class="nx">attributes</span><span class="o">:</span> <span class="p">{}</span> <span class="c1">// with no attributes</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>dear page, please read yourself ...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">read</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span>
      <span class="p">,</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">site</span><span class="p">.</span><span class="nx">logger</span>
      <span class="p">,</span> <span class="nx">resource</span>
    <span class="p">;</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">&quot;reading contents of file [&quot;</span> <span class="o">+</span> <span class="nx">page</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>we start by just reading the raw data asynchronously</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>wonderful! we have the content! let's turn it into a resource
(extract the front-matter, split into attributes and data)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">resource</span> <span class="o">=</span> <span class="nx">Page</span><span class="p">.</span><span class="nx">_createResource</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>we're just going to keep these as part of the object</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">page</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span>
      <span class="nx">page</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>set the name, which is a bit tricky since we might have
a bunch of different extensions to invoke different processors
in the process, btw, we also set up the processing pipeline</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">page</span><span class="p">.</span><span class="nx">_parseName</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>okay, we're done! let our caller know ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>once a page object is read, we can render it. this involves
invoking all the appropriate content processors and returning the result</p>

<p>you can pass in additional attributes if you want, which is handy for
layout-type page objects, where they want the HTML for their
content as an attribute ...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>if there's a layout object, let's go ahead and get it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">,</span> <span class="nx">layout</span> <span class="o">=</span> <span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">layout</span> <span class="o">&amp;&amp;</span>
          <span class="nx">page</span><span class="p">.</span><span class="nx">site</span><span class="p">.</span><span class="nx">layouts</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">layout</span><span class="p">))</span>
      <span class="p">,</span> <span class="nx">html</span>
      <span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>you can always reference site, but we don't evaluate it until necessary</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">attributes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">attributes</span><span class="o">||</span><span class="p">{});</span>
    <span class="nx">attributes</span><span class="p">.</span><span class="nx">site</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">page</span><span class="p">.</span><span class="nx">site</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span> <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>let's get the rendered content, sans the layout</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">html</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">renderWithoutLayout</span><span class="p">(</span><span class="nx">attributes</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>if we have a layout, we want to render it, passing in the html we got
from the page object as an attribute called "content" ..</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">layout</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">attributes</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">layout</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">attributes</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// otherwise, just return the html directly</span>
      <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>here we just go through each processor, passing it the result from
the previous processor along with the attributes and site object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">renderWithoutLayout</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span>
      <span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>make sure the page attributes are included, but don't
override anything that is passed in - and don't modify them</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">attributes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">attributes</span><span class="o">||</span><span class="p">{});</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="nx">attributes</span><span class="p">,</span><span class="nx">page</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">pipeline</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="nx">processor</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">processor</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">page</span><span class="p">.</span><span class="nx">site</span><span class="p">);</span>
      <span class="p">},</span><span class="nx">page</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>parse the name, using the extension elements to build up the content
processing pipeline ...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_parseName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">extensions</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)).</span><span class="nx">last</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
      <span class="p">,</span> <span class="nx">processor</span>
      <span class="p">,</span> <span class="nx">pipeline</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>go through all the extensions until we either have no more of them
or we've hit one that we don't have a processor for (this gives us an
automatic stop on extensions like "jpg" or "ico" or whatever).</p>

<p>we record the processor on the fly with the processor= bit in the test</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">while</span> <span class="p">(</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="nx">processor</span> <span class="o">=</span> <span class="nx">Page</span><span class="p">.</span><span class="nx">processors</span><span class="p">[</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">last</span><span class="p">()]))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>alright, move on to the next extensions</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">extensions</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>and add that processor to our pipeline</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pipeline</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">processor</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>whatever's left is the proper name of the page object
ex:  foo.html.textile.mustache
will pop mustache and then textile, adding them as processors
and leave us with foo.html ...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">extensions</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>and finally, save the pipeline as part of the object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">pipeline</span> <span class="o">=</span> <span class="nx">pipeline</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">toJSON</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="nx">content</span><span class="o">:</span> <span class="nx">page</span><span class="p">.</span><span class="nx">renderWithoutLayout</span><span class="p">()</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span> <span class="p">);</span>
  <span class="p">}</span>


<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Page</span><span class="p">;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 