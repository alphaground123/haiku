<!DOCTYPE html>  <html> <head>   <title>collection.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="haiku.html">                 haiku.js               </a>                                           <a class="source" href="cli.html">                 cli.js               </a>                                           <a class="source" href="collection.html">                 collection.js               </a>                                           <a class="source" href="logger.html">                 logger.js               </a>                                           <a class="source" href="page.html">                 page.js               </a>                                           <a class="source" href="server.html">                 server.js               </a>                                           <a class="source" href="site.html">                 site.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               collection.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;underscore&quot;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">Page</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;haiku/page&quot;</span><span class="p">)</span>
<span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>a collection encapsulates a directory, which each contained
file or directory being converted into either a content object
or another collection object, respectively</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Collection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">site</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">site</span><span class="p">;</span> <span class="c1">// parent site</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">parent</span><span class="o">||</span><span class="s2">&quot;root&quot;</span><span class="p">;</span> <span class="c1">// parent collection</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">path</span><span class="p">;</span> <span class="c1">// the path of the directory </span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>folder is where we keep our contents ... this helps
avoid confusion since once of the folder items is called
"content" and we also have a class Page. it also prevents 
content from accidentally overwriting, say, the render method</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>both the site and collection objects have a folder associated
with them, and it can be accessed directly, ex:
site.folder["content"] or site.folder.templates</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">folder</span> <span class="o">=</span> <span class="p">{};</span>
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>for directories, we can just use the basename with no extension
as the name of the directory - this is used in building up
hashes that don't have the full path</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">site</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;creating a new collection for [&quot;</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Collection</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>read the directory and create the content/collection objects</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">read</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span> <span class="c1">// for callbacks</span>
      <span class="p">,</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">site</span><span class="p">.</span><span class="nx">logger</span>
      <span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>okay, we start by simply reading the contents of the directory
asynchronously ... we get a list of the paths within</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">collection</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> <span class="p">}</span>
      <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">&quot;reading contents of directory [&quot;</span> <span class="o">+</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">);</span>
      </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>check to see if all the content/collections are ready
basically, if we have the same number of items in our folder as we 
do listing items to process, we must be finished, since we 
don't store them in folders except in our callback</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">isReady</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">collection</span><span class="p">.</span><span class="nx">folder</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">};</span>
      </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>now we just go through each item in the directory ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_path</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fullPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">collection</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span><span class="nx">_path</span><span class="p">)</span>
        </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>we refer to whatever we create here, whether it's a 
collection object or content object as the "content"</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="p">,</span> <span class="nx">content</span>
          </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>this is going to be the same whether or not we create a 
content object or collection objects</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">site</span><span class="o">:</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">site</span><span class="p">,</span>
            <span class="nx">parent</span><span class="o">:</span> <span class="nx">collection</span><span class="p">,</span>
            <span class="nx">path</span><span class="o">:</span> <span class="nx">fullPath</span>
          <span class="p">}</span>
          <span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>so let's figure out what this actually is ...</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> <span class="p">}</span>
          </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>if it's a directory, create a collection object</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span> <span class="p">{</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="p">}</span> 
          </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>otherwise, it must be a file, so it's a content object</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">else</span> <span class="p">{</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Page</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>okay, tell whatever it is to read itself and then call us
back whenever it's done ...</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">content</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">// yay! it finished ...</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;content processed for [&quot;</span> <span class="o">+</span> <span class="nx">_path</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>here's where we add it to the folder, so now our isReady
function will mark us as finished</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">collection</span><span class="p">.</span><span class="nx">folder</span><span class="p">[</span><span class="nx">content</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
            </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>if we're the last one to finish, then we want to do some
wrap up and invoke our caller's callback to let them know</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">isReady</span><span class="p">())</span> <span class="p">{</span> 
              <span class="nx">callback</span><span class="p">();</span> 
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">});</span> 
    <span class="p">});</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>take a path and return the content/collection object associated with it</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">resolve</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getIndex</span><span class="p">()[</span><span class="nx">path</span><span class="p">];</span> <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>get the index for this collection, which is a hash of relative paths
and content/collection objects
ex:  if the folder has a collection named "foo" which in turns contains
     a collection named bar, we could do:
         folder.foo.folder.bar
     but that's tedious. the index will gives us an entry like this:
         { "foo/bar": contentOrCollectionObject }
     for every thing within this collection (and it's collections, etc.)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">getIndex</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_index</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_index</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">_buildIndex</span><span class="p">());</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>this is the real workhorse behind resolve() and getIndex()
we'll take it one step at a time</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_buildIndex</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span> <span class="c1">// for callbacks</span>
    </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>buildling the index is easier for pages so we split the
world up into collections and pages</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">,</span> <span class="nx">collections</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">collections</span><span class="p">()</span>
      <span class="p">,</span> <span class="nx">pages</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">pages</span><span class="p">()</span>
      </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>we build up the initial index just using the pages</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">,</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">pages</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">index</span><span class="p">[</span><span class="nx">page</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">page</span><span class="p">;</span> <span class="k">return</span> <span class="nx">index</span><span class="p">;</span> <span class="p">},</span> <span class="p">{})</span>
    <span class="p">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>next we have to get the indices for each collection and add them into
our index, only with the name of collection prefixed to it; that's how
we get "foo/bar" in there</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_</span><span class="p">(</span><span class="nx">collections</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span> 
      <span class="nx">_</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">getIndex</span><span class="p">()).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">index</span><span class="p">[</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="p">});</span> 
    <span class="p">});</span>
    </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>done! nothing to it ...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">index</span><span class="p">;</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>return sub-collections of this collection (i.e. excludes pages)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">collections</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">folder</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entry</span><span class="p">,</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">entry</span> <span class="k">instanceof</span> <span class="nx">Collection</span><span class="p">;</span> 
    <span class="p">});</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>returns page content objects (i.e. excludes collections)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">pages</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">folder</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entry</span><span class="p">,</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">entry</span> <span class="k">instanceof</span> <span class="nx">Page</span><span class="p">;</span> 
    <span class="p">});</span>
  <span class="p">},</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>we create a hash with the attributes, pages, and collections
collections are accessed as a hash; pages as an array</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">toJSON</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">pages</span><span class="o">:</span> <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">()).</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span> <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
      <span class="p">},[]),</span>
      <span class="nx">collections</span><span class="o">:</span> <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collections</span><span class="p">()).</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">hash</span><span class="p">[</span><span class="nx">collection</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span> <span class="k">return</span> <span class="nx">hash</span><span class="p">;</span>
      <span class="p">},{})</span>
    <span class="p">});</span>
  <span class="p">}</span>
    
  
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Collection</span><span class="p">;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 