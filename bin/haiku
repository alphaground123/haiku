#!/usr/bin/env node

var path = require('path');

require.paths.unshift(path.join(__dirname, '..', 'lib'));

var sys  = require('sys')
  , cli = require('haiku/cli')
  , _ = require('underscore')
  , argv = require('optimist')
      .default('source', process.cwd())
      .default('destination', path.join(process.cwd(), 'build'))
      .alias('s', 'source')
      .alias('d', 'destination')
      .argv
  , action = argv._[0]
  , commands = ['new', 'build', 'server'];
;

// Set help to true if there is no action or the action is not a real command
if (!action || !_.include(commands, action)) argv.help = true;

if (argv.h || argv.help) return cli.showHelp(action);

if (action === 'build') return cli.build(argv);


// if (action === 'server'){
//   var serverHelp = [
//     'Usage:',
//     '   haiku server [options]',
//     '',
//     'Options: ',
//     '   --port PORT     # The port to fire up the haiku server defaults to 8080',
//     '   --source PATH   # The PATH to the haiku content to serve defaults to the current DIR'
//   ].join('\n');
//
//   if (argv.h || argv.help){
//     return console.log(serverHelp);
//   }
//
//   var port = argv.port || 8080
//     , source = argv.source || process.cwd()
//   ;
//
//   haiku.server({
//     source: source,
//     port: port
//   });
// }
//
// // console.log('\n\nInspecting options');
// // console.dir(argv);
